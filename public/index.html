<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Audio stream</title>
    <style>
        #player{
            position: absolute;
            top: 40px;
            right: 20px;
        }
    </style>
</head>
<body>
<h1>Audio Stream</h1>

<div id="player-div">
</div>

<div id="search-div">
    <div>
        <input id="search-input" type="text">
        <button id="search">Search</button>
    </div>
    <div id="search-results">

    </div>

</div>

<script>

    function addAudioPlayer() {
        const videoId = this.id;
        // const res = await fetch(`/audio/${videoId}`);
        // const data = res.body;

        const player = new window.Audio(`/audio/${videoId}`)
        player.preload = 'metadata'
        player.play()
        player.controls = true
        player.id = 'player'
        document.getElementById('player-div').appendChild(player);
    }


    document.getElementById('search').addEventListener('click', async function () {
        const res = await fetch(`/search/${document.getElementById('search-input').value}`);
        const data = await res.json();
        console.log(data);
        presentData(data);
    });

    function presentData(data) {
        const searchResultsDiv = document.getElementById('search-results')
        for (let i = 0; i < data.length; i++) {
            const newResult = document.createElement('div');

            const title = document.createElement('p');
            title.innerText = (i+1).toString()+'. '+data[i].title;

            const playBtn = document.createElement('button');
            playBtn.id = data[i].id;
            playBtn.classList.add('play-btn');
            playBtn.innerText = 'play this track';

            title.append(playBtn);
            newResult.append(title);
            searchResultsDiv.append(newResult);
        }
        for (let btn of document.getElementsByClassName('play-btn')){
            document.getElementById(btn.id).addEventListener('click', addAudioPlayer);
        }
    }
</script>
</body>
</html>